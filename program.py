#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Nov 28 11:39:01 2019

@author: wanghuaide
"""

import numpy as np

import random


### New code - rotation matrix from axis-angle
import math

def rotation_matrix(axis, angle):
	a = math.cos(angle/2.0)
	s = math.sin(angle/2.0)
	b = axis[0]*s
	c = axis[1]*s 
	d = axis[2]*s 
	
	return np.array([[a*a + b*b - c*c - d*d, 2*(b*c - a*d), 2*(b*d+a*c)],
					 [2*(b*c+a*d), a*a+c*c-b*b-d*d, 2*(c*d-a*b)],
					 [2*(b*d-a*c), 2*(c*d+a*b), a*a+d*d-b*b-c*c]])
### end new code 

# Lattice parameter for ag
lattice_parameter = 4.079

# Cubic FCC basis 
#basis = np.array([[1.0, 0.0, 0.0],
				  #[0.0, 1.0, 0.0],
				  #[0.0, 0.0, 1.0]])*lattice_parameter
				  
#base_atoms = np.array([[0.0, 0.0, 0.0],
					   #[0.5, 0.5, 0.0],
					   #[0.5, 0.0, 0.5],
					   #[0.0, 0.5, 0.5]])*lattice_parameter

#axis = [1, 1, 0]
#angle = np.pi/2
#rot = rotation_matrix(axis, angle)

#basis = np.matmul(rot.T, basis)
#base_atoms = np.array([np.matmul(rot,atom) for atom in base_atoms])
					   
# Size of the system cell in angstroms
#	assuming an cubic cell starting at the origin
system_size = 159.5

# Generate atom positions
positions = np.array([[-7.7169739874826027,-7.7169739874826027,0.0000000000000000],
                     [-4.6301843924895616,-7.7169739874826027,0.0000000000000000],
                     [-6.1735791899860821,-7.7169739874826027,1.5433947974965205],
                      [-1.5433947974965205,-7.7169739874826027,0.0000000000000000],
                      [-3.0867895949930411,-7.7169739874826027,1.5433947974965205],
                      [1.5433947974965205,-7.7169739874826027,0.0000000000000000],
                       [0.0000000000000000,-7.7169739874826027,1.5433947974965205],
                        [4.6301843924895616,-7.7169739874826027,0.0000000000000000],
                         [3.0867895949930411,-7.7169739874826027,1.5433947974965205],
                          [7.7169739874826027,-7.7169739874826027,0.0000000000000000],
                           [6.1735791899860821,-7.7169739874826027,1.5433947974965205],
                            [-7.7169739874826027,-4.6301843924895616,0.0000000000000000],
                             [-7.7169739874826027,-6.1735791899860821,1.5433947974965205],
                              [-6.1735791899860821,-6.1735791899860821,0.0000000000000000],
                               [-4.6301843924895616,-4.6301843924895616,0.0000000000000000],
                                [-4.6301843924895616,-6.1735791899860821,1.5433947974965205],
                                 [-6.1735791899860821,-4.6301843924895616,1.5433947974965205],
                                  [-3.0867895949930411,-6.1735791899860821,0.0000000000000000],
                                   [-1.5433947974965205,-4.6301843924895616,0.0000000000000000],
                                    [-1.5433947974965205,-6.1735791899860821,1.5433947974965205],
                                     [-3.0867895949930411,-4.6301843924895616,1.5433947974965205],
                                      [0.0000000000000000,-6.1735791899860821,0.0000000000000000],
                                       [1.5433947974965205,-4.6301843924895616,0.0000000000000000],
                                        [1.5433947974965205,-6.1735791899860821,1.5433947974965205],
                                         [0.0000000000000000,-4.6301843924895616,1.5433947974965205],
                                          [3.0867895949930411,-6.1735791899860821,0.0000000000000000],
                                           [4.6301843924895616,-4.6301843924895616,0.0000000000000000],
                                           [4.6301843924895616,-6.1735791899860821,1.5433947974965205],
                                           [3.0867895949930411,-4.6301843924895616,1.5433947974965205],
                                           [6.1735791899860821,-6.1735791899860821,0.0000000000000000],
                                           [7.7169739874826027,-4.6301843924895616,0.0000000000000000],
                                           [7.7169739874826027,-6.1735791899860821,1.5433947974965205],
                                           [6.1735791899860821,-4.6301843924895616,1.5433947974965205],
                                           [-7.7169739874826027,-1.5433947974965205,0.0000000000000000],
                                           [-7.7169739874826027,-3.0867895949930411,1.5433947974965205],
                                           [-6.1735791899860821,-3.0867895949930411,0.0000000000000000],
                                           [-4.6301843924895616,-1.5433947974965205,0.0000000000000000],
                                           [-4.6301843924895616,-3.0867895949930411,1.5433947974965205],
                                           [-6.1735791899860821,-1.5433947974965205,1.5433947974965205],
                                           [-3.0867895949930411,-3.0867895949930411,0.0000000000000000],
                                           [-1.5433947974965205,-1.5433947974965205,0.0000000000000000],
                                           [-1.5433947974965205, -3.0867895949930411,1.5433947974965205],
                                           [-3.0867895949930411, -1.5433947974965205,1.5433947974965205],
                                           [0.0000000000000000 ,-3.0867895949930411,0.0000000000000000],
                                           [1.5433947974965205 ,-1.5433947974965205,0.0000000000000000],
                                           [1.5433947974965205 ,-3.0867895949930411,1.5433947974965205],
                                           [0.0000000000000000 ,-1.5433947974965205,1.5433947974965205],
                                           [3.0867895949930411 ,-3.0867895949930411,0.0000000000000000],
                                           [4.6301843924895616 ,-1.5433947974965205,0.0000000000000000],
                                           [4.6301843924895616 ,-3.0867895949930411,1.5433947974965205],
                                           [3.0867895949930411 ,-1.5433947974965205,1.5433947974965205],
                                           [6.1735791899860821 ,-3.0867895949930411,0.0000000000000000],
                                           [7.7169739874826027 ,-1.5433947974965205,0.0000000000000000],
                                           [7.7169739874826027 ,-3.0867895949930411,1.5433947974965205],
                                           [6.1735791899860821 ,-1.5433947974965205,1.5433947974965205],
                                           [-7.7169739874826027, 1.5433947974965205,0.0000000000000000],
                                           [-7.7169739874826027, 0.0000000000000000,1.5433947974965205],
                                           [-6.1735791899860821, 0.0000000000000000,0.0000000000000000],
                                           [-4.6301843924895616, 1.5433947974965205,0.0000000000000000],
                                           [-4.6301843924895616, 0.0000000000000000,1.5433947974965205],
                                           [-6.1735791899860821, 1.5433947974965205,1.5433947974965205],
                                           [-3.0867895949930411, 0.0000000000000000,0.0000000000000000],
                                           [-1.5433947974965205, 1.5433947974965205,0.0000000000000000],
                                           [-1.5433947974965205, 0.0000000000000000,1.5433947974965205],
                                           [-3.0867895949930411, 1.5433947974965205,1.5433947974965205],
                                           [0.0000000000000000 ,0.0000000000000000,0.0000000000000000],
                                           [1.5433947974965205 ,1.5433947974965205,0.0000000000000000],
                                           [1.5433947974965205 ,0.0000000000000000,1.5433947974965205],
                                           [0.0000000000000000 ,1.5433947974965205,1.5433947974965205],
                                           [3.0867895949930411 ,0.0000000000000000,0.0000000000000000],
                                           [4.6301843924895616 ,1.5433947974965205,0.0000000000000000],
                                           [4.6301843924895616 ,0.0000000000000000,1.5433947974965205],
                                           [3.0867895949930411 ,1.5433947974965205,1.5433947974965205],
                                           [6.1735791899860821 ,0.0000000000000000,0.0000000000000000],
                                           [7.7169739874826027 ,1.5433947974965205,0.0000000000000000],
                                           [7.7169739874826027 ,0.0000000000000000,1.5433947974965205],
                                           [6.1735791899860821 ,1.5433947974965205,1.5433947974965205],
                                           [-7.7169739874826027, 4.6301843924895616,0.0000000000000000],
                                           [-7.7169739874826027, 3.0867895949930411,1.5433947974965205],
                                           [-6.1735791899860821, 3.0867895949930411,0.0000000000000000],
                                           [-4.6301843924895616, 4.6301843924895616,0.0000000000000000],
                                           [-4.6301843924895616, 3.0867895949930411,1.5433947974965205],
                                           [-6.1735791899860821, 4.6301843924895616,1.5433947974965205],
                                           [-3.0867895949930411, 3.0867895949930411,0.0000000000000000],
                                           [-1.5433947974965205, 4.6301843924895616,0.0000000000000000],
                                           [-1.5433947974965205, 3.0867895949930411,1.5433947974965205],
                                           [-3.0867895949930411, 4.6301843924895616,1.5433947974965205],
                                           [0.0000000000000000 ,3.0867895949930411,0.0000000000000000],
                                           [1.5433947974965205 ,4.6301843924895616,0.0000000000000000],
                                           [1.5433947974965205 ,3.0867895949930411,1.5433947974965205],
                                           [0.0000000000000000 ,4.6301843924895616,1.5433947974965205],
                                           [3.0867895949930411 ,3.0867895949930411,0.0000000000000000],
                                           [4.6301843924895616 ,4.6301843924895616,0.0000000000000000],
                                           [4.6301843924895616 ,3.0867895949930411,1.5433947974965205],
                                           [3.0867895949930411 ,4.6301843924895616,1.5433947974965205],
                                           [6.1735791899860821 ,3.0867895949930411,0.0000000000000000],
                                           [7.7169739874826027 ,4.6301843924895616,0.0000000000000000],
                                           [7.7169739874826027 ,3.0867895949930411,1.5433947974965205],
                                           [6.1735791899860821 ,4.6301843924895616,1.5433947974965205],
                                           [-7.7169739874826027, 7.7169739874826027,0.0000000000000000],
                                           [-7.7169739874826027, 6.1735791899860821,1.5433947974965205],
                                           [-6.1735791899860821, 6.1735791899860821,0.0000000000000000],
                                           [-4.6301843924895616, 7.7169739874826027,0.0000000000000000],
                                           [-4.6301843924895616, 6.1735791899860821,1.5433947974965205],
                                           [-6.1735791899860821, 7.7169739874826027,1.5433947974965205],
                                           [-3.0867895949930411, 6.1735791899860821,0.0000000000000000],
                                           [-1.5433947974965205, 7.7169739874826027,0.0000000000000000],
                                           [-1.5433947974965205, 6.1735791899860821,1.5433947974965205],
                                           [-3.0867895949930411, 7.7169739874826027,1.5433947974965205],
                                           [0.0000000000000000, 6.1735791899860821,0.0000000000000000],
                                           [1.5433947974965205, 7.7169739874826027,0.0000000000000000],
                                           [1.5433947974965205, 6.1735791899860821,1.5433947974965205],
                                           [0.0000000000000000, 7.7169739874826027,1.5433947974965205],
                                           [3.0867895949930411, 6.1735791899860821,0.0000000000000000],
                                           [4.6301843924895616, 7.7169739874826027,0.0000000000000000],
                                           [4.6301843924895616, 6.1735791899860821,1.5433947974965205],
                                           [3.0867895949930411, 7.7169739874826027,1.5433947974965205],
                                           [6.1735791899860821, 6.1735791899860821,0.0000000000000000],
                                           [7.7169739874826027, 7.7169739874826027,0.0000000000000000],
                                           [7.7169739874826027, 6.1735791899860821,1.5433947974965205],
                                           [6.1735791899860821, 7.7169739874826027,1.5433947974965205]])



     

def rotation(positions,axis) :    

    
    angle1 = 2*np.pi*random.random() 
    angle2 = 2*np.pi*random.random() 
    angle3 = 2*np.pi*random.random() 
    rot1 = rotation_matrix(axis[0], angle1)
    rot2 = rotation_matrix(axis[1], angle2)
    rot3 = rotation_matrix(axis[2], angle3)
    positions2 = np.matmul(positions,rot1)
    positions3 = np.matmul(positions2,rot2)
    basis = np.matmul(positions3,rot3)
    return basis

with open('rotatedprism.data','w') as fdata:
    	# First line is a comment line 
        fdata.write('Ag prism \n\n')
        fdata.write('{} atoms\n'.format(121))
        fdata.write('{} atom types\n'.format(1))
        fdata.write('{} {} xlo xhi\n'.format(-10.0, system_size))
        fdata.write('{} {} ylo yhi\n'.format(-10.0, system_size))
        fdata.write('{} {} zlo zhi\n'.format(-10.0, system_size))
        fdata.write('\n')
    # Atoms section
        fdata.write('Atoms\n\n')
#def mean(x):
    
for a in range(10):
    positionsA = positions
    
    positionsA[:,0] += random.uniform(0,130)
    positionsA[:,1] += random.uniform(0,130)
    positionsA[:,2] += random.uniform(0,150)
    A=[]
    B =[]
    C =[]    
        
    A.append(positionsA[:,0])
    B.append(positionsA[:,1])
    C.append(positionsA[:,2])
    #axis1 = np.array(max(A)-min(A)/2, 0, 0)
    #axis2 = np.array(0, max(B)-min(B)/2, 0)
    #axis3 = np.array(0, 0, max(C)-min(C)/2)
    axis0= [[np.mean(A), 0, 0],[0, np.mean(B), 0],[0, 0, np.mean(C)]]
    basis = rotation(positionsA,axis0)        
#base_atoms = np.array([np.matmul(rot,atom) for atom in base_atoms])
# Write LAMMPS data file
    with open('rotatedprism.data','a') as fdata:
    

        for i,pos in enumerate(basis):
            fdata.write('{} 1 {} {} {}\n'.format(i+1,*pos))
    		
	
	
